<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="MobileNetV4 - Universal Models for the Mobile Ecosystem # Posted by JoonSeok Kim and DongGyu Kim
Qin, Danfeng and Leichner, Chas and Delakis, Manolis and Fornoni, Marco and Luo, Shixin and Yang, Fan and Wang, Weijun and Banbury, Colby and Ye, Chengxi and Akin, Berkin and others arXiv preprint arXiv:2404.1051 Main Contributions # MobileNetV4 targets designing neural networks for mobile devices. Since the mobile platform can only offer limited compuation ability and DRAM utilization, software engineers are trying to design small and efficient neural networks.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/spring24/09_/">
  <meta property="og:site_name" content="Efficient ML Systems">
  <meta property="og:title" content="Efficient ML Systems">
  <meta property="og:description" content="MobileNetV4 - Universal Models for the Mobile Ecosystem # Posted by JoonSeok Kim and DongGyu Kim
Qin, Danfeng and Leichner, Chas and Delakis, Manolis and Fornoni, Marco and Luo, Shixin and Yang, Fan and Wang, Weijun and Banbury, Colby and Ye, Chengxi and Akin, Berkin and others arXiv preprint arXiv:2404.1051 Main Contributions # MobileNetV4 targets designing neural networks for mobile devices. Since the mobile platform can only offer limited compuation ability and DRAM utilization, software engineers are trying to design small and efficient neural networks.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="website">
<title>09 | Efficient ML Systems</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="canonical" href="http://localhost:1313/docs/spring24/09_/">
<link rel="stylesheet" href="/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css" integrity="sha256-MJt&#43;0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.e42e2ea2f0d175e58cc27d52583d6af9c3a7e0fd65c0b17b2665b054ed2a5a20.js" integrity="sha256-5C4uovDRdeWMwn1SWD1q&#43;cOn4P1lwLF7JmWwVO0qWiA=" crossorigin="anonymous"></script>

  

<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/docs/spring24/09_/index.xml" title="Efficient ML Systems" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Efficient ML Systems</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8c2bdf4d8f82cc2d8f16541464d61b3d" class="toggle" checked />
    <label for="section-8c2bdf4d8f82cc2d8f16541464d61b3d" class="flex justify-between">
      <a role="button" class="">Spring24</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/00_taco_example/" class="">00 Taco Example</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/01_/" class="">01</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/02_/" class="">02</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/03_/" class="">03</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/04_/" class="">04</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/05_/" class="">05</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/06_/" class="">06</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/07_/" class="">07</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/08_/" class="">08</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/09_/" class="active">09</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/10_/" class="">10</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/11_/" class="">11</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/12_/" class="">12</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/13_/" class="">13</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/14_/" class="">14</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/15_/" class="">15</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/16_/" class="">16</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/17_/" class="">17</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/18_/" class="">18</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/19_/" class="">19</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/20_/" class="">20</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/21_/" class="">21</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/22_/" class="">22</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/23_/" class="">23</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/24_/" class="">24</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/25_/" class="">25</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>09</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#mobilenetv4---universal-models-for-the-mobile-ecosystem">MobileNetV4 - Universal Models for the Mobile Ecosystem</a></li>
    <li><a href="#main-contributions">Main Contributions</a></li>
    <li><a href="#preliminaries---roofline-model-and-hardware-efficiency">Preliminaries - Roofline Model and Hardware Efficiency</a></li>
    <li><a href="#hardware-independent-pareto-efficiency">Hardware-Independent Pareto Efficiency</a></li>
    <li><a href="#universal-inverted-bottlenecks-uib">Universal Inverted Bottlenecks (UIB)</a></li>
    <li><a href="#mobile-mqa">Mobile MQA</a></li>
    <li><a href="#refined-nas-for-enhanced-architectures">Refined NAS for Enhanced Architectures</a></li>
    <li><a href="#results---comparisons-with-other-works">Results - Comparisons with Other Works</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h2 id="mobilenetv4---universal-models-for-the-mobile-ecosystem">
  MobileNetV4 - Universal Models for the Mobile Ecosystem
  <a class="anchor" href="#mobilenetv4---universal-models-for-the-mobile-ecosystem">#</a>
</h2>
<p><em>Posted by JoonSeok Kim and DongGyu Kim</em></p>
<ul>
<li>Qin, Danfeng and Leichner, Chas and Delakis, Manolis and Fornoni, Marco and Luo, Shixin and Yang, Fan and Wang, Weijun and Banbury, Colby and Ye, Chengxi and Akin, Berkin and others</li>
<li>arXiv preprint arXiv:2404.1051</li>
</ul>
<h2 id="main-contributions">
  Main Contributions
  <a class="anchor" href="#main-contributions">#</a>
</h2>
<p>MobileNetV4 targets designing neural networks for mobile devices. Since the mobile platform can only offer limited compuation ability and DRAM utilization, software engineers are trying to design small and efficient neural networks. To use AI at the industry level, the inference latency must also be small. Main objectives of designing inference models for mobile devices are</p>
<ul>
<li>Acceptable test performance on widely-used datasets such as ImageNet-1k</li>
<li>Low inference latency for utilization in mobile devices</li>
<li>Minimization of the number of parameters for low memory utilization on mobile platforms</li>
<li>Minimization in the number of MACs for high enegy efficiency</li>
</ul>
<p>This paper mainly focuses on lowering inference latency while maintining the test accuracy up to SOTA mobile neural net performance. Since it targets mobile platforms, it analyzes performance of various mobile hardwares, and designs a neural network to fit the harwares maximum performance. The designing process was done by the NAS technique, where the intantiation of UIB blocks were set as the search space. The main contributions of this work can be states as follows.</p>
<ol>
<li>Universal Inverted Bottleneck (UIB) seach block - Unifies the Inverted Bottleneck (IB), ConvNext, Feed Forward Netowork (FFN), and Extra Depthwise variant</li>
<li>Mobile MQA - Attention block tailored for mobile accelerators</li>
<li>NAS technique to improve performance</li>
<li>Achieves Pareto optimal acorss various devices such as CPUs, DSPs, GPUs, and TPUs</li>
<li>Novel distillation technique to boost accuracy. Achieves 87% accuracy on ImageNet-1k and 39x smaller model size</li>
</ol>
<h2 id="preliminaries---roofline-model-and-hardware-efficiency">
  Preliminaries - Roofline Model and Hardware Efficiency
  <a class="anchor" href="#preliminaries---roofline-model-and-hardware-efficiency">#</a>
</h2>
<p>Algorithm running on hardware is composed of two parts - memory access and computation. The computation time is determined by the computation requirement and hardware performance.

<link rel="stylesheet" href="/katex/katex.min.css" />
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script><span>
  \[\text{runtime\_computation} = \frac{\text{Number of Operations}}{\text{FLOPS}}\]
</span>
</p>
<p>Algorithm runtime can be limited by the memory access bottleneck or communication overhead</p>
<span>
  \[\text{runtime\_communication} = \frac{\text{Number of IO Bytes}}{\text{Bandwidth}}\]
</span>

<p>Hardware performance is determined by the upper bound of the computation time or memory access latency</p>
<span>
  \[\text{performance} = \max(\text{runtime\_computation}, \text{runtime\_communication})\]
</span>

<p>Below Fig. 1(a) and Fig. 1(b) illustrates the roofline model and its characteristics</p>
<p align="center">
    <img src='./Fig0a.png' width="900">
</p>
<p align="center">
    Fig. 1 (a) Roofline Model
</p>
<p align="center">
    <img src='./Fig0b.png' width="900">
</p>
<p align="center">
    Fig. 1 (b) Roofline Model with Ceiling
</p>
<h2 id="hardware-independent-pareto-efficiency">
  Hardware-Independent Pareto Efficiency
  <a class="anchor" href="#hardware-independent-pareto-efficiency">#</a>
</h2>
<p align="center">
    <img src='./Fig2.png' width="900">
</p>
<p align="center">
    Fig. 2. Ridge Points and Latency/Accuracy Tradeoffs
</p>
<p align="center">
    <img src='./Fig3.png' width="900">
</p>
<p align="center">
    Fig. 3. Op Cost vs. Ridge Point
</p>
This research focuses on efficiency on various hardware targets such as DSPs, CPUs, and GPUs. To find whether the hardware is limited by its memory bottlenecked or compute bottlenecked, the Roofline Model of that hardware must be investigated. It is defined by the harware's peak computational throughput and its peak memory bandwidth. The optima of that hardware can be found in its ridge point, which is defined by the hardware's ratio of Peak MACs to Peak memory bandwidth. The algorithm's accuracy and latency are swept by the ridge point on various hardware on Fig. 2, and Fig. 3. The roodline model of MobileNetV4 achieves highest Pareto-optimal performance compared to other MobileNet models. 
<p>MobileNetV4 is designed to achieve Pareto optimal and hence balances MAC operations and memory bandwidth. The initial layers are designed with high MAC intensity, so as to improve model capacity and downstream accuracy. The end layers use identically-sized FC layers to maximize accuracy. These two initial and end layers are balances so that MobileNetV4 should not see slowdowns at any hardware.</p>
<h2 id="universal-inverted-bottlenecks-uib">
  Universal Inverted Bottlenecks (UIB)
  <a class="anchor" href="#universal-inverted-bottlenecks-uib">#</a>
</h2>
<p align="center">
    <img src='./Fig4.png' width="900">
</p>
<p align="center">
    Fig. 4. Universal Inverted Bottleneck (UIB) blocks
</p>
<p>The main advantage of UIB is its adaptability and flexibility, that mitigates seach complexity. Optional Depthwise (DW) convolution blocks are inserted before the expansion layer, and between the expansion and projection layer. In the NAS procedure, common components such as the pointwise expansion and projection are shared and DWs are added as search options. UIB has four possible instantiations as follows.</p>
<ul>
<li>Inverted Bottleneck (IB) : Spatial mixing on the expanded features activations, and provides higher model capacity</li>
<li>ConvNext : Cheaper spatial mixing before the expansion with larger kernel size</li>
<li>ExtraDW : Inexpensive increase of the network depth and the receptive field. Combined benefits of ConvNext and IB</li>
<li>FFN : Stack of two 1x1 pointwise convolutions. Accelerator-friendly operation</li>
</ul>
<h2 id="mobile-mqa">
  Mobile MQA
  <a class="anchor" href="#mobile-mqa">#</a>
</h2>
<p align="center">
    <img src='./Table1.png' width="500">
</p>
<p align="center">
    Table 1. Efficiency Gains by MQA
</p>
<p>This paper considers the Operational Intensity (OI), which is the ratio of arithmetic operations to memory access, to enhance efficiency of vision models on mobile accelerators. Here, Multi-Query Attention (MQA) is proposed instead od Multi-Head Self Attention (MHSA), which is simplified by utilization of shared keys and values across all heads. This sharing of keys and values reduces memory access hence improving OI, especially when the batch size is small. Large language models does not have significant accuracy drop in this MQA case. Table 1 shows that by adding MHSA and MQA, the performace accuracy has increased whereas the inference latency for MQA is approximately x39 lower than that of MHSA. Hence, MQA can accelerate better in the mobile environment, with negligible performance degradation.</p>
<p>The Spatial Reduction Attention (SRA) is applied, hence incorporating asymmetric spatial down-sampling, to downscale keys and values, and not queries. In hybrid models, there is a certain correlation between spatially adjacent tokens, hence necessitating spatial mixing convolution filters.</p>
<h2 id="refined-nas-for-enhanced-architectures">
  Refined NAS for Enhanced Architectures
  <a class="anchor" href="#refined-nas-for-enhanced-architectures">#</a>
</h2>
<p>As shown above, the insitantiation of UIB blocks are in the neural architecture search process. TuNAS was adopted for the paper&rsquo;s search strategy. The paper uses a two-stage search operation, the coarse-grained search and fine-grained serach to address the variance in parameter counts between UIB&rsquo;s depthwise layers and other search options. The course-grained search process involves determining optimal filter sizes with fixed parameters. The fine-grained stage searches for the UIB&rsquo;s layer configuration.</p>
<h2 id="results---comparisons-with-other-works">
  Results - Comparisons with Other Works
  <a class="anchor" href="#results---comparisons-with-other-works">#</a>
</h2>
<p align="center">
    <img src='./Table5.png' width="900">
</p>
<p align="center">
    Table 5. Classification results on ImageNet-1k
</p>
<p align="center">
    <img src='./Table6.png' width="500">
</p>
<p align="center">
    Table 6. Object Detection results on the COCO validation set
</p>
<p>Results on the classification performance on ImageNet-1k dataset show that the MobileNetV4 achieves the highest performance and smallest latency compareed to other models on various mobile platforms such as CPUs and DSPs of mobile phones. While other models have closely competitive latency with the MobileNetV4 model, their latency is much higher.</p>
<p>The effectiveness of MobileNetV4 as backbone networks are tested on the COCO object detection experiment. The number of MACs were set to be similiar, and the Retina framework was used as the object detector. As the same as classification, MobileNetV4 achieves highest performance compared to other mobile-target modles, with the lowest CPU latency. Hence, the ability of MobileNetV4 for mobile devices can be shown.</p>
<h2 id="conclusion">
  Conclusion
  <a class="anchor" href="#conclusion">#</a>
</h2>
<ul>
<li>
<p>This paper proposes the MobileNet V4 series, a universal high-efficiency model that operates efficiently across a wide range of mobile environments.</p>
</li>
<li>
<p>By introducing a new Universal Inverted Bottleneck and Mobile MQA layer and applying an enhanced NAS recipe, MobileNet V4 achieves near Pareto-optimal performance on various hardware, including mobile CPUs, GPUs, DSPs, and dedicated accelerators.</p>
</li>
<li>
<p>Additionally, using the latest distillation techniques, it demonstrates cutting-edge performance in mobile computer vision by achieving 87% ImageNet-1K accuracy with a latency of 3.8ms on the Pixel 8 EdgeTPU.</p>
</li>
<li>
<p>The paper also presents a theoretical framework and analysis for understanding the model&rsquo;s universality across heterogeneous devices, providing guidance for future design.</p>
<h2 id="references">
  References
  <a class="anchor" href="#references">#</a>
</h2>
</li>
</ul>
<p>MobileNetV4 Implementation: [<a href="https://github.com/scalable-model-editing/unified-model-editing">Link</a>.](<a href="https://github.com/jiaowoguanren0615/MobileNetV4/tree/main">https://github.com/jiaowoguanren0615/MobileNetV4/tree/main</a>)</p>
<p>Qin, Danfeng and Leichner, Chas and Delakis, Manolis and Fornoni, Marco and Luo, Shixin and Yang, Fan and Wang, Weijun and Banbury, Colby and Ye, Chengxi and Akin, Berkin and others. 2024. [<a href="https://arxiv.org/pdf/2305.13172">Editing large language models: Problems, methods, and opportunities</a>](<a href="https://arxiv.org/pdf/2404.10518%29">https://arxiv.org/pdf/2404.10518)</a>. arXiv preprint arXiv:2404.10518.</p>
<p>Sandler, Mark and Howard, Andrew and Zhu, Menglong and Zhmoginov, Andrey and Chen, Liang-Chieh. 2018. <a href="https://arxiv.org/pdf/1801.04381">https://arxiv.org/pdf/1801.04381</a>, Proceedings of the IEEE conference on computer vision and pattern recognition.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/effml-postech/blog-post/commit/bec6d750b68fd9e5d05826d0219f6c9de45b624b" title='Last modified by adrs97 | May 22, 2024' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="" />
      <span>May 22, 2024</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/effml-postech/blog-post/edit/main//content/docs/spring24/09_/_index.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#mobilenetv4---universal-models-for-the-mobile-ecosystem">MobileNetV4 - Universal Models for the Mobile Ecosystem</a></li>
    <li><a href="#main-contributions">Main Contributions</a></li>
    <li><a href="#preliminaries---roofline-model-and-hardware-efficiency">Preliminaries - Roofline Model and Hardware Efficiency</a></li>
    <li><a href="#hardware-independent-pareto-efficiency">Hardware-Independent Pareto Efficiency</a></li>
    <li><a href="#universal-inverted-bottlenecks-uib">Universal Inverted Bottlenecks (UIB)</a></li>
    <li><a href="#mobile-mqa">Mobile MQA</a></li>
    <li><a href="#refined-nas-for-enhanced-architectures">Refined NAS for Enhanced Architectures</a></li>
    <li><a href="#results---comparisons-with-other-works">Results - Comparisons with Other Works</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












