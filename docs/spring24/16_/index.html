<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Accelerating Transformers via Conditional Computation: As Aspect of Mixture of Depths # Posted by: Inkwan Hwang, Minjae Park
This image was produced using DALL·E 3. Introduction # “Choice and concentration” is an effective strategies for achieving success in problems. Sometimes, it is not necessary to consume same amount of effort and time into all problems. Expending energy on trivial issues may fail to concentrate on what truly matters. Similarly, in language models, there is a technique that does not focus equally on all tokens but allocates less budget to non-essential tokens.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/spring24/16_/">
  <meta property="og:site_name" content="Efficient ML Systems">
  <meta property="og:title" content="Efficient ML Systems">
  <meta property="og:description" content="Accelerating Transformers via Conditional Computation: As Aspect of Mixture of Depths # Posted by: Inkwan Hwang, Minjae Park
This image was produced using DALL·E 3. Introduction # “Choice and concentration” is an effective strategies for achieving success in problems. Sometimes, it is not necessary to consume same amount of effort and time into all problems. Expending energy on trivial issues may fail to concentrate on what truly matters. Similarly, in language models, there is a technique that does not focus equally on all tokens but allocates less budget to non-essential tokens.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="website">
<title>16 | Efficient ML Systems</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="canonical" href="http://localhost:1313/docs/spring24/16_/">
<link rel="stylesheet" href="/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css" integrity="sha256-MJt&#43;0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.56d9534326453b231190a634b66617c8ed5ae5c2b45e5356ff1c56d2098f8f28.js" integrity="sha256-VtlTQyZFOyMRkKY0tmYXyO1a5cK0XlNW/xxW0gmPjyg=" crossorigin="anonymous"></script>

  

<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/docs/spring24/16_/index.xml" title="Efficient ML Systems" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Efficient ML Systems</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8c2bdf4d8f82cc2d8f16541464d61b3d" class="toggle" checked />
    <label for="section-8c2bdf4d8f82cc2d8f16541464d61b3d" class="flex justify-between">
      <a role="button" class="">Spring24</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/00_taco_example/" class="">00 Taco Example</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/01_/" class="">01</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/02_/" class="">02</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/03_/" class="">03</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/04_/" class="">04</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/05_/" class="">05</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/06_/" class="">06</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/07_/" class="">07</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/08_/" class="">08</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/09_/" class="">09</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/10_/" class="">10</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/11_/" class="">11</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/12_/" class="">12</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/13_/" class="">13</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/14_/" class="">14</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/15_/" class="">15</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/16_/" class="active">16</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/17_/" class="">17</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/18_/" class="">18</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/19_/" class="">19</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/20_/" class="">20</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/21_/" class="">21</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/22_/" class="">22</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/23_/" class="">23</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/24_/" class="">24</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/spring24/25_/" class="">25</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>16</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction"><strong>Introduction</strong></a></li>
    <li><a href="#understanding-the-problem-uniform-computation-in-transformers"><strong>Understanding the problem: Uniform computation in Transformers</strong></a></li>
    <li><a href="#conditional-computation-for-transformers"><strong>Conditional Computation for transformers</strong></a></li>
    <li><a href="#overview-to-mixture-of-depths-mod"><strong>Overview to Mixture-of-Depths (MoD)</strong></a></li>
    <li><a href="#capacity-based-routing-schemes"><strong>Capacity based routing schemes</strong></a></li>
    <li><a href="#implementation-detail"><strong>Implementation detail</strong></a></li>
    <li><a href="#open-source-mod"><strong>Open source MoD</strong></a></li>
    <li><a href="#conclusion-and-discussion"><strong>Conclusion and discussion</strong></a></li>
    <li><a href="#some-resources"><strong>Some resources</strong></a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="accelerating-transformers-via-conditional-computation-as-aspect-of-mixture-of-depths">
  <strong>Accelerating Transformers via Conditional Computation: As Aspect of Mixture of Depths</strong>
  <a class="anchor" href="#accelerating-transformers-via-conditional-computation-as-aspect-of-mixture-of-depths">#</a>
</h1>
<p><em>Posted by: Inkwan Hwang, Minjae Park</em></p>
<p align="center">
    <img src=./Pondering_Transformer.jpg> 
</p>
This image was produced using DALL·E 3.
<h2 id="introduction">
  <strong>Introduction</strong>
  <a class="anchor" href="#introduction">#</a>
</h2>
<p>“Choice and concentration” is an effective strategies for achieving success in problems. Sometimes, it is not necessary to consume same amount of effort and time into all problems. Expending energy on trivial issues may fail to concentrate on what truly matters. Similarly, in language models, there is a technique that does not focus equally on all tokens but allocates less budget to non-essential tokens. This technique is called conditional computation.</p>
<p>In this post, We will explain conditional computation strategies for Transformers, focusing on a technology announced this year called <strong>Mixture-of-Texture.</strong></p>
<p>paper:  <a href="https://arxiv.org/abs/2404.02258"><U>Mixture-of-Depths: Dynamically allocating compute in transformer-based language models</U></a></p>
<p>Let&rsquo;s dive in!</p>
<h2 id="understanding-the-problem-uniform-computation-in-transformers">
  <strong>Understanding the problem: Uniform computation in Transformers</strong>
  <a class="anchor" href="#understanding-the-problem-uniform-computation-in-transformers">#</a>
</h2>
<p>These days, most language models are based on Transformers, and we stack these blocks to make big models. When given an input sequence, tokens pass through these blocks to predict the next token. The problem is that the models spread computations uniformly across input sequences. Transformers use the same amount of computation for essential tokens as for non-essential ones. For instance, predicting a token within a sentence is cheaper than predicting the first token of the next sentence. Researchers want to address this issue by making Transformers focus their computations on the tokens that is important.</p>
<h2 id="conditional-computation-for-transformers">
  <strong>Conditional Computation for transformers</strong>
  <a class="anchor" href="#conditional-computation-for-transformers">#</a>
</h2>
<ul>
<li>
<p>Early exiting</p>
<p>Early Exit method is a method when the model decides to end computation on a given token, allowing it skips the remaining layers. Difference between MoD is, MoD can choose whether skip middle layer or not, but Early Exit method can&rsquo;t.</p>
</li>
<li>
<p>CoLT5</p>
</li>
<li>
<p>Mixture of Experts (MoE)</p>
<p>MoE is an model which consists of parallel expert models which is fitted to certain domains. Like MoD, token-level routing decisions are made across the network depth. Difference between MoD is, MoD chooses path to transformer or to residual connection, MoE chooses path to transformer(Expert) or to transformer(Expert) or both.</p>
</li>
</ul>
<h2 id="overview-to-mixture-of-depths-mod">
  <strong>Overview to Mixture-of-Depths (MoD)</strong>
  <a class="anchor" href="#overview-to-mixture-of-depths-mod">#</a>
</h2>
<p align="center">
    <img src=./Mixture-of-Depths.png> 
</p>
<p>MoE is an model which consists of parallel expert models which is fitted to certain domains.
Like MoD, token-level routing decisions are made across the network depth.
Difference between MoD is, MoD chooses path to transformer or to residual connection, MoE chooses path to transformer(Expert) or to transformer(Expert) or both.</p>
<h2 id="capacity-based-routing-schemes">
  <strong>Capacity based routing schemes</strong>
  <a class="anchor" href="#capacity-based-routing-schemes">#</a>
</h2>
<ul>
<li>
<p>Token-choice routing</p>
</li>
<li>
<p>Expert-choice routing</p>
</li>
<li>
<p>Expert-choice MoD</p>
</li>
</ul>
<h2 id="implementation-detail">
  <strong>Implementation detail</strong>
  <a class="anchor" href="#implementation-detail">#</a>
</h2>

<link rel="stylesheet" href="/katex/katex.min.css" />
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script><span>
  \[x^{l&#43;1}_i=\begin{cases}r^{l}_i f_i(\tilde{X}^l)&#43;x^{l}_i, &amp; r^{l}_i &gt;  P_\beta(R^l)\\x^{l}_i, &amp; r^{l}_i &lt;  P_\beta(R^l)\end{cases}\]
</span>

<p>논문 요약</p>
<h2 id="open-source-mod">
  <strong>Open source MoD</strong>
  <a class="anchor" href="#open-source-mod">#</a>
</h2>
<p><a href="https://github.com/astramind-ai/Mixture-of-depths">https://github.com/astramind-ai/Mixture-of-depths</a></p>
<h2 id="conclusion-and-discussion">
  <strong>Conclusion and discussion</strong>
  <a class="anchor" href="#conclusion-and-discussion">#</a>
</h2>
<p>논문 요약 + 내 생각</p>
<h2 id="some-resources">
  <strong>Some resources</strong>
  <a class="anchor" href="#some-resources">#</a>
</h2>
<p>참고문헌 정리</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/effml-postech/blog-post/commit/ea16098d013089b2fb396c6a572a609d37982895" title='Last modified by Inkwan Hwang | May 21, 2024' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="" />
      <span>May 21, 2024</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/effml-postech/blog-post/edit/main//content/docs/spring24/16_/_index.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction"><strong>Introduction</strong></a></li>
    <li><a href="#understanding-the-problem-uniform-computation-in-transformers"><strong>Understanding the problem: Uniform computation in Transformers</strong></a></li>
    <li><a href="#conditional-computation-for-transformers"><strong>Conditional Computation for transformers</strong></a></li>
    <li><a href="#overview-to-mixture-of-depths-mod"><strong>Overview to Mixture-of-Depths (MoD)</strong></a></li>
    <li><a href="#capacity-based-routing-schemes"><strong>Capacity based routing schemes</strong></a></li>
    <li><a href="#implementation-detail"><strong>Implementation detail</strong></a></li>
    <li><a href="#open-source-mod"><strong>Open source MoD</strong></a></li>
    <li><a href="#conclusion-and-discussion"><strong>Conclusion and discussion</strong></a></li>
    <li><a href="#some-resources"><strong>Some resources</strong></a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












